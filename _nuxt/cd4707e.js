(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{246:function(t,e,n){var content=n(281);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(65).default)("0118a48f",content,!0,{sourceMap:!1})},280:function(t,e,n){"use strict";n(246)},281:function(t,e,n){var r=n(64)(!1);r.push([t.i,"main[data-v-a94018ee]{margin:1em auto;display:table}main .info[data-v-a94018ee]{display:flex;justify-content:space-between;align-items:center}main .info .progress[data-v-a94018ee]{text-align:right}main .display[data-v-a94018ee]{font-size:5rem;padding:2em 0;text-align:center}main .display .typed[data-v-a94018ee]{color:#aaa;padding:0 0 0 1em}main .display .typed[data-v-a94018ee],main .display .will_typing[data-v-a94018ee]{border-top:1px solid #eee;border-bottom:1px solid #eee}main .display .will_typing[data-v-a94018ee]{padding:0 1em 0 0}main .display .hint[data-v-a94018ee]{font-size:3rem}main .keyboard[data-v-a94018ee]>:nth-child(2){margin-left:2em}main .keyboard[data-v-a94018ee]>:nth-child(3){margin-left:3em}main .keyboard[data-v-a94018ee]>:nth-child(5){margin-left:14em}main .keyboard ul[data-v-a94018ee]{display:flex;padding:0;list-style-type:none;position:relative}main .keyboard ul li[data-v-a94018ee]{border:1px solid #ddd;width:4em;line-height:4em;min-height:4em;text-align:center;margin:.1rem}main .keyboard ul li.pressed[data-v-a94018ee]{background-color:#faa;transform:translateY(.1rem)}main .keyboard ul li.key_Space[data-v-a94018ee]{width:19.8em}main .keyboard ul li.key_ShiftLeft[data-v-a94018ee]{width:5em}main .keyboard ul li.key_ShiftRight[data-v-a94018ee]{width:7.2em}main .keyboard ul li.key_Enter[data-v-a94018ee]{position:absolute;right:0;width:6.2em;height:8.5em;border-left:none;border-bottom:none}main .keyboard ul li.hilight[data-v-a94018ee]{border-color:#ff0}main .histories[data-v-a94018ee]{margin-top:1rem;max-height:30rem;overflow:auto}main .histories>ul[data-v-a94018ee]{display:flex;flex-direction:column-reverse;width:70rem}main .histories .miss_words[data-v-a94018ee]{display:flex;flex-wrap:wrap;list-style-type:none;padding:0}main .histories .miss_word[data-v-a94018ee]{padding:0 1rem;border-radius:.5em;background-color:#faa;color:red;margin:.1rem}main .alert[data-v-a94018ee]{position:fixed;top:0;right:0;bottom:0;left:0;z-index:9999;background-color:rgba(0,0,0,.5);display:flex;justify-content:center;align-items:center}main .alert .popup[data-v-a94018ee]{background-color:#fff;color:#333;border-radius:1em;padding:1em;position:relative;margin-bottom:5rem}main .alert .popup button[data-v-a94018ee]{position:absolute;top:-2rem;right:-2rem;width:3rem;height:3rem}main .clickable[data-v-a94018ee]{cursor:pointer}",""]),t.exports=r},287:function(t,e,n){"use strict";n.r(e);n(23),n(29),n(38),n(39);var r=n(5),o=n(251),c=n(18),l=n(284),d=n(124),h=n(125),f=(n(40),n(8),n(252),n(20),n(256),n(258),n(260),n(261),n(262),n(263),n(264),n(265),n(266),n(267),n(268),n(269),n(270),n(271),n(272),n(273),n(24),n(43),n(41),n(36),n(67),n(53),n(54),n(178),n(179),n(274),n(51),n(180),n(275),n(122),n(35),n(182),n(123),n(276),n(278),n(279),n(37),n(181),n(1));function m(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return y(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return y(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,l=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return c=t.done,t},e:function(t){l=!0,o=t},f:function(){try{c||null==n.return||n.return()}finally{if(l)throw o}}}}function y(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var v=function(){function t(text){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Date,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Date;Object(d.a)(this,t),this.text=text,this.start=e,this.typed=n,this.end=r}return Object(h.a)(t,[{key:"duration",get:function(){return this.end.getTime()-this.start.getTime()}},{key:"miss_count",get:function(){return this.typed.length-this.text.length}},{key:"toJSON",value:function(){return{text:this.text,start:this.start,typed:this.typed,end:this.end}}}],[{key:"from",value:function(e){return new t(e.text,new Date(e.start),e.typed,new Date(e.end))}}]),t}(),_=function(){function t(e,n){Object(d.a)(this,t),this.subject=e,this.records=n,this.miss_words=Object(l.a)(new Set(this.records.filter((function(i){return i.text!=i.typed})).map((function(i){return i.text}))))}return Object(h.a)(t,[{key:"toString",value:function(){var t=this.records.reduce((function(p,t){return p+t.duration}),0),e=Math.floor(t/1e3),n=("000"+t%1e3).slice(-3),r=this.records.reduce((function(p,t){return p+t.typed.length}),0),o=this.records.reduce((function(p,t){return p+t.text.length}),0),c=o/(t/1e3);return"[".concat(this.start.toLocaleString(),"] ").concat(this.subject,"(").concat(this.records.length,") ").concat(e,".").concat(n," 秒 タイプ数 ").concat(r," ミス数 ").concat(r-o," 速度 ").concat(Math.floor(c),".").concat(("00"+Math.floor(100*c)).slice(-2)," 文字/秒")}},{key:"start",get:function(){return this.records[0].start}},{key:"toJSON",value:function(){return{subject:this.subject,records:this.records}}}],[{key:"from",value:function(e){return new t(e.subject,e.records.map(v.from))}}]),t}(),k=function(){function t(label,code,e){Object(d.a)(this,t),this.label=label,this.code=code,this.clazz=e}return Object(h.a)(t,[{key:"toJSON",value:function(){return{label:this.label,code:this.code,clazz:this.clazz}}}]),t}(),w=function(){function t(){var e=this;Object(d.a)(this,t),this.keymaps=[],this.pressed=[],this.translators=[],this.keydown=function(t){t.preventDefault(),e.pressed.includes(t.keyCode)||e.pressed.push(t.keyCode),e.handler&&e.handler(t.keyCode,t.key)},this.keyup=function(t){t.preventDefault();var n=e.pressed.indexOf(t.keyCode);n>=0&&e.pressed.splice(n,1)}}return Object(h.a)(t,[{key:"attach",value:function(t){t.addEventListener("keydown",this.keydown),t.addEventListener("keyup",this.keyup)}},{key:"detach",value:function(t){t.removeEventListener("keydown",this.keydown),t.removeEventListener("keyup",this.keyup)}},{key:"onpress",set:function(t){this.handler=t}},{key:"is_pressed",value:function(code){return this.pressed.includes(code)}},{key:"is_valid",value:function(code){return null!=this.keymaps.flat().find((function(i){return i.code==code}))}},{key:"load",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";this.keymaps=t.split(/\r?\n/).map((function(line){return line.split("\t").map((function(t){var e=t.split("|"),n=Object(c.a)(e,3),label=n[0],code=n[1],r=n[2];return new k(label,Number(code),r)}))})),e.length>0&&(this.translators=e.split(/\r?\n/).map((function(line){var t=line.split("\t"),e=Object(o.a)(t);return{to:e[0],froms:e.slice(1)}})))}},{key:"match",value:function(t,input){var e=this.translators.filter((function(i){return t.startsWith(i.to)})),n={from:"",to:""};return e.forEach((function(i){var t=i.froms.filter((function(t){return input.endsWith(t)}));if(t.length>0){var e=t.reduce((function(a,b){return a.length>b.length?a:b}));null!=e&&i.to.length>n.to.length&&(n.from=e,n.to=i.to)}})),n.from.length?n:null}},{key:"hint",value:function(t){for(var e=[];t.length>0;)if(/[- ^\\@[;:\],./!"#$%&'()=~|`{+*}<>?_0-9a-zA-Z]/.test(t.charAt(0)))e.push(t.charAt(0)),t=t.substr(1);else{var n=this.translators.filter((function(i){return t.startsWith(i.to)})).sort((function(a,b){return b.to.length-a.to.length}))[0],r=n.froms[0];e.push(r),t=t.substr(n.to.length)}return e.join("")}}]),t}(),x=function(){function t(e,n,r){Object(d.a)(this,t),this.subject=e,this.words=n,this.limit_keys=r}return Object(h.a)(t,[{key:"toJSON",value:function(){return{subject:this.subject,words:this.words}}}]),t}(),j=f.a.extend({data:function(){return{keyboard:new w,typed:"",text:"",indexes:[],records:[],doing:!1,histories:[],courses:[],course_index:0,alert:"",audio:null,review_course:null}},fetch:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n,l,d,h,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={headers:{Accept:"text/plain"},responseType:"text"},e.next=3,Promise.all([t.$axios.$get("/api/typing/keymaps",n),t.$axios.$get("/api/typing/romaji",n)]);case 3:return l=e.sent,d=Object(c.a)(l,2),h=d[0],f=d[1],t.keyboard.load(h,f),e.t0=Promise,e.next=11,t.$axios.$get("/api/typing/index",n);case 11:return e.t1=e.sent.split(/\r?\n/).map(function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(line){var r,c,l,d,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=line.split("\t"),c=Object(o.a)(r),l=c[0],d=c.slice(1),!l.startsWith("#")){e.next=3;break}return e.abrupt("return");case 3:if(1!=d.length){e.next=7;break}return e.next=6,t.$axios.$get(d[0],n);case 6:d=e.sent.split(/\r?\n/).filter((function(i){return i.trim().length>0}));case 7:return h=void 0,l.startsWith("|")&&(h=d.map((function(i){return t.keyboard.keymaps.flat().find((function(t){return t.label.toLowerCase()==i}))})).filter((function(i){return null!=i})),l=l.substr(1)),e.abrupt("return",new x(l,d,h));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=14,e.t0.all.call(e.t0,e.t1);case 14:t.courses=e.sent.filter((function(i){return null!=i}));case 15:case"end":return e.stop()}}),e)})))()},fetchOnServer:!1,created:function(){this.$nuxt.$emit("sidebar_disabled",!0)},mounted:function(){this.audio=new Audio("/type.mp3"),this.histories=localStorage.typing__histories&&JSON.parse(localStorage.typing__histories).map(_.from)||[],this.keyboard.attach(document),this.keyboard.onpress=this.onpress},beforeDestroy:function(){this.keyboard.detach(document)},computed:{will_typing:function(){return this.text.substr(this.typed.length)},record:function(){return this.records[this.records.length-1]},course:function(){return this.review_course?this.review_course:this.courses[this.course_index]},hint:function(){return this.keyboard.hint(this.text)}},watch:{histories:function(t){localStorage&&(localStorage.typing__histories=JSON.stringify(t))}},methods:{next:function(){if(this.typed="",this.record&&(this.record.end=new Date),this.indexes.length<=0){if(this.doing=!1,this.histories.push(new _(this.course.subject,this.records)),this.course_index+1<this.courses.length)this.course_index++;else if(this.review_course===this.course){var t=this.histories.slice(-1)[0].miss_words;t.length>0?this.review_course=new x("再復習",t):(this.alert="おめでとうございます！全ステップをクリアしました！",this.review_course=null,this.course_index=0)}else this.review_course=new x("総復習",Object(l.a)(new Set(this.histories.flatMap((function(i){return i.miss_words})))));this.records=[],this.text=""}else this.text=this.course.words[this.indexes.shift()],this.records.push(new v(this.text))},setup:function(t){if(this.indexes=Array.from(Array(this.course.words.length)).map((function(t,i){return i})),t){var e,n=m(this.indexes);try{for(n.s();!(e=n.n()).done;){var i=e.value,r=Math.floor(Math.random()*this.course.words.length),o=[this.indexes[i],this.indexes[r]];this.indexes[r]=o[0],this.indexes[i]=o[1]}}catch(t){n.e(t)}finally{n.f()}}},onpress:function(code,t){var e;if(this.alert.length>0)this.alert="";else{if(null===(e=this.audio)||void 0===e||e.play(),!this.doing&&32==code)return this.setup(!0),this.next(),void(this.doing=!0);if(this.keyboard.is_valid(code)){if(8==code)return void(this.typed.length>0&&(this.typed=this.typed.slice(0,-1)));if(!this.doing)return;if(this.record.typed+=t,this.will_typing.charAt(0)==t)this.typed+=t;else{var n=this.keyboard.match(this.will_typing,this.record.typed);n&&(this.typed+=n.to,this.record.typed=this.record.typed.slice(0,-n.from.length)+n.to)}this.typed==this.text&&(this.record.text=this.text,this.next())}}},review:function(t){this.doing?this.alert="終了してからです":this.review_course=new x("".concat(t.start.toLocaleString(),"の復習"),t.miss_words.flatMap((function(i){return[i,i]})))},key_class:function(t){var e={pressed:this.keyboard.is_pressed(t.code)};return t.clazz&&(e["key_"+t.clazz]=!0),this.course.limit_keys&&this.course.limit_keys.find((function(i){return i.code==t.code}))&&(e.hilight=!0),e}}}),O=(n(280),n(44)),component=Object(O.a)(j,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.course?n("main",[n("div",{staticClass:"info"},[n("h1",{staticClass:"course"},[t._v("\n      Step "+t._s(t.courses.indexOf(t.course)+1)+" "+t._s(t.course.subject)+"("+t._s(t.course.words.length)+")\n    ")]),t._v(" "),t.doing?n("div",{staticClass:"progress"},[t._v("あと "+t._s(t.indexes.length+1))]):t._e()]),t._v(" "),t.keyboard.keymaps.length>0?[n("div",{class:{display:!0,doing:t.doing}},[t.doing?[n("span",{staticClass:"typed"},[t._v(t._s(t.typed))]),n("span",{staticClass:"will_typing"},[t._v(t._s(t.will_typing))])]:n("span",[t._v("スペースキーで開始します")]),t._v(" "),n("div",{staticClass:"hint"},[t._v(t._s(t.text!=t.hint?t.hint:"　"))])],2),t._v(" "),n("div",{staticClass:"keyboard"},t._l(t.keyboard.keymaps,(function(e,r){return n("ul",{key:r},t._l(e,(function(e,i){return n("li",{key:i,class:t.key_class(e)},[t._v("\n          "+t._s(e.label)+"\n        ")])})),0)})),0),t._v(" "),n("div",{staticClass:"histories"},[n("h3",[t._v("履歴（クリックすると間違い単語の練習ができます）")]),t._v(" "),n("span",{staticClass:"miss_word"},[t._v("ミスした単語")]),t._v(" "),n("ul",t._l(t.histories,(function(e,i){return n("li",{key:i,class:{clickable:e.miss_words.length>0},on:{click:function(n){e.miss_words.length>0&&t.review(e)}}},[t._v("\n          "+t._s(e)+"\n          "),n("ul",{staticClass:"miss_words"},t._l(e.miss_words,(function(e,r){return n("li",{key:r,staticClass:"miss_word"},[t._v("\n              "+t._s(e)+"\n            ")])})),0)])})),0)])]:t._e(),t._v(" "),t.alert.length>0?n("div",{staticClass:"alert"},[n("form",{staticClass:"popup",on:{submit:function(e){e.preventDefault(),t.alert=""}}},[n("p",[t._v(t._s(t.alert))]),t._v(" "),n("button",{attrs:{type:"submit"}},[n("font-awesome-icon",{attrs:{icon:"times"}})],1)])]):t._e()],2):n("main",[t._v("Now Loading...")])}),[],!1,null,"a94018ee",null);e.default=component.exports}}]);